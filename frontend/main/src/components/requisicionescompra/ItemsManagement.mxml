<?xml version="1.0" encoding="utf-8"?>
<mx:DataGrid xmlns:mx="http://www.adobe.com/2006/mxml" width="100%" height="250"
			 dataProvider="{new ArrayCollection()}"
			 editable="{this._purchaseOrderMode}">
	<mx:Script>
		<![CDATA[
			import model.PartidaRequisicionCompra;
			import model.Util;
			
			import mx.collections.ArrayCollection;
			private var _purchaseOrderMode:Boolean = false;
			
			public function addItem(entry:PartidaRequisicionCompra):void{
				if( entry == null ){
					return;
				}
				(this.dataProvider as ArrayCollection).addItem( entry );
			}
			
			public function reset():void
			{
				Util.removeItems( this.dataProvider );
			}
			
			public function set purchaseOrderMode(value:Boolean):void{
				this._purchaseOrderMode = value;
			}
			
			private function labelFunctionImporte(item:Object, column:DataGridColumn):String{
				var returnValue:String = "";
				if( item != null &&
					item.cantidad != null &&
					item.costo != null ){
					var cantidad:Number = Util.stringToNumber(item.cantidad);
					if( !isNaN( cantidad ) ){
						returnValue = (cantidad*item.costo).toString();
					}
				}
				return returnValue;
			}
		]]>
	</mx:Script>
	<mx:columns>
		<mx:DataGridColumn id="dtgItemCode" headerText="Código"
						   dataField="codigo"
						   width="80"/>
		<mx:DataGridColumn id="dtgItemFamily" headerText="{'Grupo o\nFamilia'}"
						   width="100"
						   dataField="grupoFamilia"/>
		<mx:DataGridColumn id="dtgItemDescription" headerText="Descripción"
						   dataField="descripcion"
						   width="160"/>
		<mx:DataGridColumn id="dtgItemQuantity" headerText="Cantidad"
						   dataField="cantidad"
						   width="60"
						   textAlign="right"/>
		<mx:DataGridColumn id="dtgItemUnit" headerText="Unidad"
						   dataField="unidad"
						   width="60"
						   textAlign="right"/>
		<mx:DataGridColumn id="dtgItemValidation" headerText="Validación"
						   dataField="validacion"
						   width="80"/>
		<mx:DataGridColumn id="dtgItemEstatus" headerText="Estatus"
						   dataField="fkEstatus"
						   width="80"
						   editable="{!this._purchaseOrderMode}"
						   >
			<mx:itemRenderer>
				<mx:Component>
					<mx:ComboBox dataProvider="{this.items}"
								 enabled="{Model.getInstance().user.allowedPerfil(1)}"
								 labelField="estatus"
								 creationComplete="creationCompleteHandler(event)"
								 preinitialize="preinitializeHandler(event)">
						<mx:Script>
							<![CDATA[
								import model.EstatusRequisicionCompra;
								import model.Model;
								import model.Util;
								
								import mx.collections.ArrayCollection;
								import mx.events.FlexEvent;
								
								[Bindable]
								private var items:ArrayCollection;
								
								protected function preinitializeHandler(event:FlexEvent):void
								{
									this.items = EstatusRequisicionCompra.getAll();
								}
								
								protected function creationCompleteHandler(event:FlexEvent):void
								{
									this.updateData();
								}
								
								override public function set data(value:Object):void
								{
									if( value == null ){
										return;
									}
									super.data = value;
									this.updateData();
								}
								
								private function updateData():void{
									this.selectedIndex=Util.selectedIndexFromCombo(this.items, data.fkEstatus);
								}
							]]>
						</mx:Script>
					</mx:ComboBox>
				</mx:Component>
			</mx:itemRenderer>
		</mx:DataGridColumn>
		<mx:DataGridColumn id="dtgPrice"
						   dataField="costo"
						   headerText="Costo"
						   textAlign="right"
						   visible="{this._purchaseOrderMode}"/>
		<mx:DataGridColumn id="dtgImport"
						   dataField="importe"
						   headerText="Importe"
						   labelFunction="labelFunctionImporte"
						   textAlign="right"
						   editable="false"
						   visible="{this._purchaseOrderMode}"/>
	</mx:columns>
</mx:DataGrid>	
